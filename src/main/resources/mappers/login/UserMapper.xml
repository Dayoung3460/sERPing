<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beauty1nside.security.mapper.UserMapper">

    <resultMap type="UserDTO" id="userMap">
        <id column="employee_num" property="employeeNum"/>
        <result property="employeeId" column="employee_id"/>
        <result property="employeePw" column="employee_pw"/>
        <result property="employeeName" column="employee_name"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="position" column="position"/>
        <result property="companyNum" column="company_num"/>
        <result property="companyEngName" column="company_eng_name"/>
        <result property="departmentNum" column="department_num"/>
        <result property="authority" column="authority"/>
        <collection
                property="roles"
                ofType="RoleDTO"
                select="getRole"
                column="employee_num"
        />
    </resultMap>
    <select id="getUser" resultMap="userMap">
        select h.employee_num,
               h.employee_id,
               h.employee_pw,
               h.employee_name,
               h.email,
               h.phone,
               h.position,
               h.company_num,
               h.department_num,
               h.authority,
               e.company_eng_name
        from hr_employee h join erp_company e
         on   h.company_num = e.company_num
        where h.employee_id = #{employeeId}
    </select>
    <select id="getRole" resultType="RoleDTO">
        select 'ROLE_'||c.cmmn_code as role_name
        from hr_employee h
                 join cmmn c on (h.authority = c.cmmn_code)
        where employee_num = #{employeeNum}
    </select>
</mapper>