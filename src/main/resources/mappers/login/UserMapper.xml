<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.beauty1nside.security.mapper.UserMapper">

    <resultMap type="com.beauty1nside.security.service.UserDTO" id="userMap">
        <id column="employeeNum" property="employeeNum"/>
        <result property="employeeId" column="employee_id"/>
        <result property="employeePw" column="employee_pw"/>
        <result property="employeeName" column="employee_name"/>
        <result property="email" column="email"/>
        <result property="phone" column="phone"/>
        <result property="position" column="position"/>
        <result property="companyNum" column="company_num"/>
        <result property="departmentNum" column="department_num"/>
        <collection
                property="roles"
                ofType="RoleDTO"
                select="getRole"
                column="employeeNum"
        />
    </resultMap>
    <select id="getUser" resultMap="userMap">
        select employee_num,
               employee_id,
               employee_pw,
               employee_name,
               email,
               phone,
               position,
               company_num,
               department_num
        from hr_employee
        where employee_id = #{employeeId}
    </select>

    <!--
    role id를 넘겨주면 롤이름 반환
    getRole의 조회 결과가 바로 DTO로 들어가는게 아니라 resultMap을 거쳐서 감
    -->
<!--    <select id="getRole" resultType="com.beauty1nside.security.service.RoleDTO">-->
<!--        select role_name-->
<!--        from t_user_role u-->
<!--        join t_role r on (u.role_id = r.id)-->
<!--        where id = #{id}-->
<!--    </select>-->
    <select id="getRole" resultType="com.beauty1nside.security.service.RoleDTO">
        select role_name
        from hr_employee h
                 join cmmn c on (h.authority = c.cmmn_code)
        where employee_num = #{employeeNum}
    </select>
</mapper>