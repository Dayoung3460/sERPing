<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}" lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    
    <!-- TOAST UI Library -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/hr/style.css}">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        
    <title>인사 발령 관리</title>
</head>

<body layout:fragment="content">

<div class="container mt-3">
    <div class="row">
        <div class="col">
            <h2>인사 발령 관리</h2>
        </div>
    </div>

    <!-- 🔍 검색 필터 (기존 검색 조건 유지) -->
    <div class="search-box bg-light p-3 rounded shadow-sm">
        <!-- 기존 검색 필터 코드 유지 -->
        <div class="row align-items-center">
            <div class="col-md-2 text-end"><label class="fw-bold">검색 기준</label></div>
            <div class="col-md-3">
                <select class="form-select" id="searchCategory">
                    <option value="전체">전체</option>
                    <option value="employeeName">사원명</option>
                    <option value="employeeId">사원ID</option>
                    <option value="phone">연락처</option>
                </select>
            </div>
            <div class="col-md-5">
                <input type="text" class="form-control" placeholder="검색어 입력 후 [Enter]" id="searchKeyword">
            </div>
        </div>

        <!-- 부서 & 하위 부서 -->
        <div class="row align-items-center">
            <div class="col-md-2 text-end"><label class="fw-bold">부서</label></div>
            <div class="col-md-6 d-flex">
                <select class="form-select w-50 pe-1" id="searchDepartment">
                    <option value="">선택</option>
                </select>
                <div class="col-md-1"></div>
                <select class="form-select w-50" id="searchSubDepartment">
                    <option value="">선택</option>
                </select>
            </div>
        </div>

        <!-- 직급 -->
        <div class="row align-items-center">
            <div class="col-md-2 text-end"><label class="fw-bold">직급</label></div>
            <div class="col-md-6">
                <select class="form-select w-50" id="searchPosition">
                    <option value="">선택</option>
                </select>
            </div>
        </div>
        
        <!-- 조회 & 초기화 버튼 -->
        <div class="row">
            <div class="col text-center">
                <button class="btn btn-primary me-2" onclick="searchEmployees()" id="searchBtn">조회</button>
                <button class="btn btn-outline-success" onclick="resetFilters()">초기화</button>
            </div>
        </div>
    </div>
    
    <!-- 디버깅용: Thymeleaf에서 statuses와 employmentTypes 값 확인 -->
<p th:text="${statuses}"></p>
<p th:text="${employmentTypes}"></p>

    <!-- 🔘 버튼 영역 (사원 등록 → 인사 발령 등록) -->
    <div class="row mt-3">
        <div class="col text-end">
            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#empChangeModal">인사 발령 등록</button>
        </div>
    </div>

    <!-- 🔲 TOAST UI GRID (컬럼 변경됨) -->
    <div class="row mt-3">
        <div class="col">
            <div id="grid"></div>
            <div id="pagination" class="tui-pagination"></div>
        </div>
    </div>

</div>


<!-- 📌 TOAST GRID 설정 -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const grid = new tui.Grid({
        el: document.getElementById('grid'),
        data: [], // 서버에서 데이터 가져와야 함
        columns: [
            { header: "사원ID", name: "employeeId", width: 100 },
            { header: "이름", name: "employeeName", width: 120 },
            { header: "현재 직급", name: "currentPosition", width: 100 },
            { header: "변경 직급", name: "newPosition", width: 120, editor: "text" },
            { header: "현재 부서", name: "currentDepartment", width: 120 },
            { header: "이동 부서", name: "newDepartment", width: 120, editor: "text" },
            { header: "발령 일자", name: "changeDate", width: 120, editor: "datePicker" },
            { header: "발령 사유", name: "reason", width: 180, editor: "text" }
        ],
        pageOptions: {
            useClient: true,
            perPage: 10
        }
    });

    // 서버에서 데이터 불러오는 함수
    function loadEmployees() {
        fetch("/hr/rest/emp/list")
            .then(response => response.json())
            .then(data => grid.resetData(data))
            .catch(() => alert("사원 목록 불러오기 실패"));
    }

    loadEmployees();
});
</script>

<!-- 📌 모달 JS 변경 (사원 등록 → 인사 발령 등록) -->
<script src="/js/hr/employee.js"></script>
<script src="/js/hr/common-codes.js"></script>
<!--<script src="/js/hr/emp_change_modal.js"></script>  ✅ 인사 발령 모달용 JS 파일 추가 -->

<!-- 📌 인사 발령 등록 모달 추가 -->
<!-- <div th:replace="~{hr/emp_change_modal :: empChangeModal}"></div> -->

</body>
</html>
