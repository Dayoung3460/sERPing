<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
 <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css">
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
    
    
    <style>
    	.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #ccc;
    border-top-color: #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
    </style>
</head>
<body>
	<div id="loadingContents" style="display: none;">
		<p><strong>ìš”êµ¬ ìˆ˜ëŸ‰(box)</strong> :  [ <span id="demendQnt"></span> ]</p>
		<p><strong>í˜„ì¬ ì˜ˆì•½ ì´ ìˆ˜ëŸ‰(box)</strong> :  [ <span id="totalQnt"></span> ]</p>
		<div id="registerGrid" ></div>
	</div>
	
	 <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
    </div>
	 
	
	<script>
        let registerGrid;
        
        
		
        document.addEventListener("DOMContentLoaded", function () {
        	registerGrid = new tui.Grid({
            	
                el: document.getElementById('registerGrid'),
                columns: [
                    { header: 'LOTë²ˆí˜¸', name: 'goodsLotNum',width:'auto' },
                    { header: 'ì˜ˆì•½ê°€ëŠ¥ìˆ˜ëŸ‰(box)', name: 'warehousingRemainingQuantity'  },
                    { header: 'ìœ í†µê¸°í•œ', name: 'goodsConsumptionDate', formatter: ({ value }) => formatDate(value) },
                    { header: 'LOTì˜ˆì•½ìˆ˜ëŸ‰(box)', name: 'deliveryQnt', editor: 'text'  }
                ],
                data: [],
                rowHeaders: ['rowNum', 'checkbox'],
                pageOptions: {
                    useClient: false,
                    perPage: 50
                },
                dataSource: LotListDataSource 

            });
         	
        });
        
     	

        // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ë°ì´í„° ì—…ë°ì´íŠ¸
        document.getElementById('registerModal').addEventListener('shown.bs.modal', function () {
			
            
            if (registerGrid) {
            	
                //console.log(selectedRow);
                loadLotDetail(selectedRow.optionCode, selectedRow.deliveryDetailId, companyNum);
                
            }
        });
        
        function loadLotDetail(optionCode, deliveryDetailId, companyNum ) {
        	if (!optionCode || !deliveryDetailId || !companyNum) {
                console.warn("ìœ íš¨í•˜ì§€ ì•Šì€ ìƒì„¸ì •ë³´ì…ë‹ˆë‹¤.");
                return;
            }
        	
        	showLoading();
        	
            fetch(`/bsn/rest/goods/lot?optionCode=${optionCode}&deliveryDetailId=${deliveryDetailId}&companyNum=${companyNum}`)
            	
                .then(response => response.json())
                .then(data => {
                    if (data && data.data && data.data.contents) {
                    	const detailData = data.data.contents; // ìƒì„¸ ë°ì´í„° ì €ì¥
                    	

                    	registerGrid.resetData(detailData);
                    } else {
                        console.warn("ìƒì„¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        resetData([]); // ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
                    }
                })
                .catch(error => console.error('Error fetching order detail:', error))
            	.finally(() => {
                	hideLoading(); // âœ… ë¡œë”© ì¢…ë£Œ
                	document.getElementById('loadingContents').style.display = 'block';
                	// âœ… ë°ì´í„°ë¥¼ ë¡œë“œí•œ í›„ ë ˆì´ì•„ì›ƒ ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => {
                        registerGrid.refreshLayout();
                    }, 100);
            	});
        }
        
     // ğŸ“Œ REST APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
     
     const LotListDataSource = {
		api: {
			readData: { url: '/bsn/rest/goods/lot', method: 'GET', initParams: { page: 1 }},
			//?optionCode=${selectedRow.optionCode}&deliveryDetailId=${selectedRow.deliveryDetailId}
		},
		contentType: 'application/json'
	 };
     
     
  // ë¡œë”© í™”ë©´ í‘œì‹œ
     function showLoading() {
         document.getElementById('loadingOverlay').style.display = 'flex';
     }

     // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
     function hideLoading() {
         document.getElementById('loadingOverlay').style.display = 'none';
     }
     
     
  	
		
     
     
     
    </script>
</body>
</html>