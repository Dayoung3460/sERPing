<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
 <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css">
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
</head>
<body>

	<div id="registerGrid"></div>
	 
	<script>
        let registerGrid;


		
        document.addEventListener("DOMContentLoaded", function () {
            registerGrid = new tui.Grid({
                el: document.getElementById('registerGrid'),
                columns: [
                    { header: 'LOTë²ˆí˜¸', name: 'goodsLotNum', },
                    { header: 'ì˜ˆì•½ê°€ëŠ¥ìˆ˜ëŸ‰(box)', name: 'warehousingRemainingQuantity',  },
                    { header: 'ìœ í†µê¸°í•œ', name: 'goodsConsumptionDate', formatter: ({ value }) => formatDate(value), },
                    { header: 'LOTì˜ˆì•½ìˆ˜ëŸ‰(box)', name: 'deliveryQnt', editor: 'text',  }
                ],
                data: LotListDataSource,
                rowHeaders: ['rowNum', 'checkbox'],
                pageOptions: {
                    useClient: false,
                    perPage: 50
                }
            });
         	
        });
        
     	

        // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ë°ì´í„° ì—…ë°ì´íŠ¸
        document.getElementById('registerModal').addEventListener('shown.bs.modal', function () {
            if (registerGrid) {
            	
                console.log(selectedRow);
                console.log(companyNum);
                loadLotDetail(selectedRow.optionCode, selectedRow.deliveryDetailId, companyNum);
                registerGrid.reloadData();
                registerGrid.refreshLayout();
            }
        });
        
        async function loadLotDetail(optionCode, deliveryDetailId, companyNum ) {
        	if (!optionCode || !deliveryDetailId || !companyNum) {
                console.warn("ìœ íš¨í•˜ì§€ ì•Šì€ ìƒì„¸ì •ë³´ì…ë‹ˆë‹¤.");
                return;
            }
        	
            fetch(`/bsn/rest/goods/lot?optionCode=${optionCode}&deliveryDetailId=${deliveryDetailId}&companyNum=${companyNum}`)
            	
                .then(response => {
        	            if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
        	            return response.json();
        	     })
        	     
                .then(data => {
                    if (data && data.data && data.data.contents) {
                    	const detailData = data.data.contents; // ìƒì„¸ ë°ì´í„° ì €ì¥
                    	

                    	registerGrid.resetData(detailData);
                    } else {
                        console.warn("ìƒì„¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        //orderDetailGrid.resetData([]); // ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
                    }
                })
                .catch(error => console.error('Error fetching order detail:', error));
        }
        
     // ğŸ“Œ REST APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
     const LotListDataSource = {
		api: {
			readData: { url: '/bsn/rest/goods/lot', method: 'GET', initParams: { page: 1 }},
			//?optionCode=${selectedRow.optionCode}&deliveryDetailId=${selectedRow.deliveryDetailId}
		},
		contentType: 'application/json'
	 };
     
     function formatDate(dateString) {
    	    if (!dateString) return ''; // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
    	    const date = new Date(dateString);
    	    if (isNaN(date)) return dateString; // ë‚ ì§œ ë³€í™˜ì´ ì‹¤íŒ¨í•˜ë©´ ì›ë³¸ ìœ ì§€
    	    

    	    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    	}
     
  	
		
     
     
     // í…Œì´ë¸” ë°ì´í„° ì—†ì„ë•Œ ë‚˜ì˜¤ëŠ” ë¬¸êµ¬
		function REnodata(){
			//console.log("ì¡°íšŒì¤‘");
			setTimeout( () => {
				let nodata = document.querySelectorAll('.tui-grid-layer-state-content p')[0];
				nodata.innerHTML = 'í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
			}, 100)
		}
    </script>
</body>
</html>