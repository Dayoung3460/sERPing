<!DOCTYPE html>
<!-- =======================================================
	* ERP회사 관리자페이지 사용회사 관리 페이지
	* @author ERP 관리자 개발팀 표하연
	* @since 2025.02.12
	* @version 1.0
	* @see
	*
	* <pre>
	* << 개정이력(Modification Information) >>
	*
	*   수정일      수정자          수정내용
	*  ======    =======    ==============================
	*  2025.02.12  표하연          최초생성
	*
	*  </pre>
======================================================== -->
<html xmlns:th="http://www.thymeleaf.org"
	layout:decorate="~{/erp/layouts/main}">


<div class="container w-100 mw-1600" layout:fragment="content">
	<div class="d-flex flex-column mb-1">
		<div class="d-flex justify-content-start p-0 mt-2">
			<h2>회사관리</h2>
		</div>
		<!-- 회사 검색 영역 -->
		<div class="p-2">
			<div class="d-flex justify-content-center border border-primary-subtle rounded-3 bg-primary-subtle p-3">
				<div class="form-check me-3">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckDefault"> <label class="form-check-label"
						for="flexCheckDefault"> 계약 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 미계약 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 서비스 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 일시정지 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 종료 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 남은기간 10일
						미만 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 정기구독 </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value=""
						id="flexCheckChecked" checked> <label
						class="form-check-label" for="flexCheckChecked"> 기간구독 </label>
				</div>
			</div>
		</div>
		<!-- 회사 검색 영역 끝 -->
		<!-- 토스트 그리드 영역 -->
		<div class="p-2">
			<div class="d-flex justify-content-center">
				<!--  -->
				<div id="grid"></div>
				<div id="pagination" class="tui-pagination"></div>
			</div>
		</div>
		<!-- 토스트 그리드 영역 끝 -->
		<!-- 데이터 처리 영역 -->
		<div class="pt-2 ps-2 pe-2">
		    <div class="d-flex justify-content-center border border-primary-subtle rounded-3 p-0" style="height: 400px;">
		        <!-- 왼쪽 영역 -->
		        <div class="d-flex flex-column flex-grow-1 flex-wrap p-1 btn-list" style="max-width: 50%;">
		            <div class="d-flex flex-wrap mb-1 justify-content-end">
		                <div class="p-1"><button type="button" class="btn btn-outline-success btn-sm">회사등록</button></div>
		                <div class="p-1"><button type="button" class="btn btn-outline-danger btn-sm">닫기</button></div>
		            </div>
		            <!-- 폼시작 -->
		            <form action="#">
		            <!-- EQ01=단순문의 / EQ02=상태변경 / EQ03=발행 / EQ04=신규등록 -->
		            <input type="hidden" value="EQ04" id="customerServiceDivision" name="customerServiceDivision">
		            <div class="d-flex flex-wrap mb-1">
		            	<div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">회사번호</span>
								<input type="number" class="form-control" id="companyNum" name="companyNum" readonly="readonly" style="width: 50px">
							</div>
		                </div>
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">회사명</span>
								<input type="text" class="form-control" id="companyName" name="companyName" style="width: 125px">
							</div>
		                </div>
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">회사영문명</span>
								<input type="text" class="form-control" id="companyEngName" name="companyEngName" style="width: 125px">
							</div>
		                </div>
		                <div class="p-0">
							<div class="input-group input-group-sm mb-1">
								<span class="input-group-text">사업자번호</span>
								<input type="text" class="form-control" id="businessNum1" name="businessNum1" style="width: 50px">
								<input type="text" class="form-control" id="businessNum2" name="businessNum2" style="width: 40px">
								<input type="text" class="form-control" id="businessNum3" name="businessNum3" style="width: 60px">
							</div>
						</div>
		            </div>
		            <div class="d-flex flex-wrap mb-1">
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">대표자명</span>
								<input type="text" class="form-control" id="representationName" name="representationName" style="width: 75px">
							</div>
		                </div>
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">대표자연락처</span>
								<input type="text" class="form-control" id="representationPhone" name="representationPhone" style="width: 120px">
							</div>
		                </div>
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">담당자명</span>
								<input type="text" class="form-control" id="chargerName" name="chargerName" style="width: 75px">
							</div>
		                </div>
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1">
								<span class="input-group-text">담당자연락처</span>
								<input type="text" class="form-control" id="chargerPhone" name="chargerPhone" style="width: 120px">
							</div>
		                </div>
		            </div>
		            <div class="d-flex flex-wrap mb-1">
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">email</span>
								<input type="text" class="form-control" id="chargerEmail" name="chargerEmail" style="width: 240px;">
							</div>
		                </div>
		                <div class="p-0">
			                <div class="input-group input-group-sm mb-1">
							  <input type="file" class="form-control" placeholder="png, jpg, pdf 가능" id="businessLicense" name="businessLicense" style="width: 240px;">
							  <button class="btn btn-outline-secondary" type="button" id="businessLicense_upload">업로드</button>
							</div>
		                </div>
		            </div>
		            <div class="d-flex flex-wrap mb-1">
		                <div class="p-0">
							<div class="input-group input-group-sm mb-1 pe-1">
								<span class="input-group-text">주소</span>
								<input type="text" class="form-control" id="companyAddress" name="companyAddress" style="width: 300px;">
								<button class="btn btn-outline-secondary" type="button" id="companyAddress_search">주소검색</button>
							</div>
		                </div>
		                <div class="p-0">
		                	<div class="input-group input-group-sm mb-1">
								<span class="input-group-text">나머지주소</span>
								<input type="text" class="form-control" id="chargerEmail" name="chargerEmail" style="width: 240px;">
							</div>
		                </div>
		            </div>
		            <div class="d-flex align-items-stretch mb-1">
					    <div class="p-0 flex-grow-1 me-2">
					        <div class="mb-1">
					            <label class="form-label">내용 등록</label>
					            <textarea class="form-control" id="customerServiceContent" name="customerServiceContent" rows="4"></textarea>
					        </div>
					    </div>
					    <div class="p-0">
					        <div class="mb-1 h-100">
					            <button type="button" class="btn btn-outline-success h-100"><b>회 사<br><br>등 록</b></button>
					        </div>
					    </div>
					</div>
		            </form>
		            <!-- 폼시작 끝 -->
		        </div>
		
		        <!-- 가운데 구분선 -->
		        <div class="d-flex justify-content-center align-items-center">
		            <div class="vr border-start border-primary-subtle" style="width: 2px; height: 100%;"></div>
		        </div>
		
		        <!-- 오른쪽 영역 -->
		        <div class="d-flex justify-content-center flex-grow-1 p-1" style="max-width: 50%;">
		            처리
		        </div>
		    </div>
		</div>
		<!-- 데이터 처리 영역 끝-->
	</div>


	<script>
		document.addEventListener("DOMContentLoaded", function() {
		});
		//그리드 선언
		var Grid = tui.Grid;
		const dataSource = {
			api : {
				readData : { url : '/erp/rest/comlist', method : 'GET', initParams : { param : 'param' } },
			//createData: { url: '/api/createData', method: 'POST' },
			//updateData: { url: '/api/updateData', method: 'PUT' },
			//modifyData: { url: 'http://localhost:81/api/board/modifyData', method: 'PUT' },
			//deleteData: { url: '/api/deleteData', method: 'DELETE' },
			},
			contentType : 'application/json',
		};

		//그리드 생성
		const grid = new Grid({
			el : document.getElementById('grid'), // 컨테이너 엘리먼트
			pageOptions : {
				useClient : false, //페이지 네이션 할꺼면 false // 자동으로 하게할껴면 true
				perPage : 5, //한페이지에 몇개 보여줄지
			},
			//칼럼 정하기
			columns: [
				{ header: "회사번호", name: "companyNum", editor: 'text' },
				{ header: "회사명", name: "companyName", editor: 'text' },
				{ header: "대표자명", name: "representationName", editor: 'text' },
				{ header: "담당자명", name: "chargerName", editor: 'text' },
				{ header: "담당자연락처", name: "chargerPhone", editor: 'text' },
				{ header: "이메일", name: "chargerEmail", editor: 'text' },
				{ header: "사업자등록증", name: "businessLicense", editor: 'text' },
				{ header: "계약서", 
			        name: "contractNum", 
			        formatter: function({ value }) {
			            if (value === 0) {
			            	return `미계약`;
			            } else {
			                return `<button class="btn btn-info" data-id="${value}" onclick="contractAction(${value})">계약</button>`;
			            }
			        },
			        editor: 'text',
				},
				{ header: "상태", name: "serviceState", 
					formatter: function({ value }) {
			            if (value === 'EC01') {
			            	return `서비스`;
			            } else if (value === 'EC02') {
			            	return `일시정지`;
			            } else {
			                return `종료`;
			            }
			        },
			        editor: 'text',
				},
				{ header: "남은기간", name: "remainingDays", editor: 'text',
					//해당행 전체 데이터 가져오기
					formatter: function({ row }) {
						// 만료일 가져오기
			            const endDateStr = row.subscriptionEndDate; 
			          	//마지막 날짜 만들기
			            const endDate = new Date(endDateStr);	
			         	// 오늘 날짜 만들기
			            const today = new Date();	
			         	// 만료일 - 오늘날짜 (미리초로 데이터 반환)
			            const timeDiff = endDate.getTime() - today.getTime();
			            // 미리초 데이터를 일 단위로 변환
			            const remainingDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

			            if(remainingDays > 0){
			            	return `${remainingDays}일 남음`;
			            }else if(remainingDays <= 0 && remainingDays >= 9){
			            	//나중에 붉은색 스타일 넣을꺼 가만하고 분리
			            	return `${remainingDays}일 남음`;
			            }else{
				            return `종료`;
			            }
			        },
			    },
				{ header: "구독형태", name: "subscriptionForm", editor: 'text',
					formatter: function({ value }) {
			            if (value === 'EL01') {
			            	return `기간구독`;
			            } else if (value === 'EL02') {
			            	return `정기구독`;
			            }
			        },
			    },
				{ header: "만료일", name: "subscriptionEndDate", editor: 'text' },
			],
			//초기 데이터 뭘로 할지
			data : dataSource,
		});
		
		
		
		// 주소검색 api
		document.addEventListener("DOMContentLoaded", function() {
		    // 주소 검색 버튼 클릭 이벤트
		    document.getElementById("companyAddress_search").addEventListener("click", function() {
		        new daum.Postcode({
		            oncomplete: function(data) {
		                // 검색된 주소 데이터 처리
		                var fullAddress = data.address; // 기본 주소
		                var extraAddress = ''; // 참고항목 (예: 건물명)
		
		                if (data.addressType === 'R') { // 지번 주소가 아닌 도로명 주소
		                    if (data.bname !== '') {
		                        extraAddress += data.bname;
		                    }
		                    if (data.buildingName !== '') {
		                        extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
		                    }
		                    fullAddress += (extraAddress !== '' ? ' (' + extraAddress + ')' : '');
		                }
		
		                // 주소 입력 필드에 값 설정
		                document.getElementById("companyAddress").value = fullAddress;
		            }
		        }).open();
		    });
		});
		// 주소검색 api 끝
	</script>
</div>