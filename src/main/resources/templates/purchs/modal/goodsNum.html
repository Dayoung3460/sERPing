<html xmlns:th="http://www.thymeleaf.org">

<body>
 
   <style>

        
       /* âœ… ì „ì²´ ê·¸ë¦¬ë“œì˜ ìŠ¤í¬ë¡¤ ì œê±° */
		#productGrid {
		    width: 100% !important;
		    min-width: 100%;  /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
		    height: auto !important;
		}

		
		/* âœ… ë‚´ë¶€ ìš”ì†Œì—ì„œ ê°•ì œ ìŠ¤í¬ë¡¤ ì œê±° */
		.tui-grid-body-area {
		    overflow: hidden !important;
		}
		
		/* âœ… ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì—†ì• ê¸° */
		.tui-grid-container {
		    max-width: 100% !important;
		    overflow-x: auto !important;  /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½ */
		}

		
		/* ìƒí’ˆëª… & ìƒí’ˆì½”ë“œ ë³‘í•©ëœ ì…€ ìŠ¤íƒ€ì¼ */
		.merged-cell {
		    background-color: #f8f9fa !important; /* ì—°í•œ íšŒìƒ‰ */
		    font-weight: bold;
		    text-align: left !important;
		    vertical-align: middle !important;  /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
		    line-height: normal !important;
		    padding: 15px !important;
		   
		}
	
		
		/* âœ… ê·¸ë¦¬ë“œ ì „ì²´ í…Œë‘ë¦¬ ì¶”ê°€ */
		.tui-grid-container {
		   
		    border-radius: 5px; /* ë‘¥ê·¼ í…Œë‘ë¦¬ */
		    overflow: hidden; /* ëª¨ì„œë¦¬ ê¹”ë”í•˜ê²Œ ì •ë¦¬ */
		}
		
		/* âœ… í—¤ë”(ì»¬ëŸ¼ëª…) ë¶€ë¶„ í…Œë‘ë¦¬ */
		.tui-grid-header-area {
		    border-bottom: 2px solid #ccc !important; /* í—¤ë”ì™€ ë°”ë”” êµ¬ë¶„ */
		}
		
		/* âœ… ì…€(Cell) í…Œë‘ë¦¬ ì„¤ì • */
		.tui-grid-cell {
		    border-right: 1px solid #ddd !important;
		    border-bottom: 1px solid #ddd !important;
		}
		
		/* âœ… ë§ˆì§€ë§‰ ì»¬ëŸ¼ì˜ í…Œë‘ë¦¬ ì—†ì• ê¸° (ë””ìì¸ ê°œì„ ) */
		.tui-grid-cell:last-child {
		    border-right: none !important;
		}
		
		/* âœ… ë§ˆì§€ë§‰ í–‰ì˜ í…Œë‘ë¦¬ ì—†ì• ê¸° (ë””ìì¸ ê°œì„ ) */
		.tui-grid-body-area .tui-grid-cell:last-child {
		    border-bottom: none !important;
		}
		
		/* âœ… í—¤ë”(ì»¬ëŸ¼ëª…) ë°°ê²½ìƒ‰ & ê¸€ì”¨ ìŠ¤íƒ€ì¼ */
		.tui-grid-header-cell {
		    background-color: #f1f1f1 !important; /* í—¤ë” ë°°ê²½ìƒ‰ */
		    font-weight: bold;
		    text-align: center;
		    border-right: 1px solid #ddd !important;
		}
		
		/* âœ… ì¤„ ê°„ê²© ìŠ¤íƒ€ì¼ ì¡°ì • */
		.tui-grid-row {
		    border-bottom: 1px solid #ddd !important;
		}
		
		/* âœ… hover(ë§ˆìš°ìŠ¤ ì˜¤ë²„) ì‹œ ê°•ì¡° íš¨ê³¼ */
		.tui-grid-cell:hover {
		    background-color: #f9f9f9 !important;
		}
	
	/* ì´ ì¬ê³ ê°€ ì•ˆì „ì¬ê³  ì´í•˜ì¸ ê²½ìš° ë¶‰ì€ìƒ‰ ê°•ì¡° */
		.low-stock-warning {
		    
		    color: #d9534f !important; /* ì§„í•œ ë¶‰ì€ìƒ‰ ê¸€ì */
		    font-weight: bold;
		}
		
		/* ê·¸ë¦¬ë“œ ì„ íƒí•˜ë©´ ìƒê¸°ëŠ” ìƒ‰ìƒ */
		.tui-grid-row-highlight {
		    background-color: #d7fffe !important; /* f0f8ff ì—°í•œ í•˜ëŠ˜ìƒ‰ */
		}
	

</style>


<div class="container mt-4">
	   <!-- ê²€ìƒ‰ì°½ -->
	<div class="search-grid" id="custom-modal-container">
	    <div class="d-flex flex-wrap align-items-center gap-3">
	        <div class="d-flex align-items-center">
	            <span class="label-search me-2">ìƒí’ˆëª…</span>
	            <input type="text" name="goodsName" id="searchGoodsNumName" class="form-control w-auto">
	        </div>
	        <div class="d-flex align-items-center">
	            <span class="label-search me-2">ë¸Œëœë“œëª…</span>
	            <input type="text" name="brandName" id="searchBrandNumName" class="form-control w-auto">
	        </div>
	        <div class="d-flex align-items-center">
	            <span class="label-search me-2">í‘œì‹œìˆ˜ëŸ‰</span>
	            <select name="display_num_amount" id="product_num_display_amount" class="form-control w-auto" onchange="changeProductDisplay()">
	                <option value="10" selected>10</option>
	                <option value="20">20</option>
	                <option value="50">50</option>
	                <option value="100">100</option>
	            </select>
	        </div>
	        <button type="button" class="btn btn-primary ms-auto" onclick="productNumSearch()">ê²€ìƒ‰</button>
	        <button type="button" class="btn btn-secondary" onclick="resetNumFilters()">ì´ˆê¸°í™”</button>
	    </div>
	</div>
	
	<!-- ìƒí’ˆë³„ ê·¸ë¦¬ë“œ -->
	<div id="table-container" class="mt-3">
	    <div id="productNumGrid"></div>
	</div>
	


</div>

 <script>

console.log("ê°¯ìˆ˜ê·¸ë¦¬ë“œ")
document.addEventListener("DOMContentLoaded", function () {
    console.log("âœ… DOMContentLoaded ì‹¤í–‰ë¨");

    // âœ… productNumGridê°€ ìˆëŠ”ì§€ í™•ì¸
    console.log("ğŸ“Œ productNumGrid ì—˜ë¦¬ë¨¼íŠ¸ ì¡´ì¬ ì—¬ë¶€: ", document.getElementById('productNumGrid'));

    if (document.getElementById('productNumGrid')) {
        initProductNumGrid();
    } else {
        console.warn("âŒ productNumGrid ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
    
    let selectedRowKey = null;
    
 // âœ… ê·¸ë¦¬ë“œê°€ ì´ˆê¸°í™”ëœ í›„ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
    setTimeout(() => {
        if (typeof productNumGrid !== 'undefined' && productNumGrid !== null) {
            console.log("âœ… productNumGrid ì´ë²¤íŠ¸ ë“±ë¡");
            
            productNumGrid.on("click", function (ev) {
                console.log("âœ… ì£¼ë¬¸ì„œì—ì„œ ì„ íƒí•œ í–‰:", ev.rowKey);
                
                if (selectedRowKey !== null) {
                	productNumGrid.removeRowClassName(selectedRowKey, 'tui-grid-row-highlight');
                }
            	// í´ë¦­í•œ í–‰ì— ê°•ì¡° íš¨ê³¼ ì¶”ê°€
        		productNumGrid.addRowClassName(ev.rowKey, 'tui-grid-row-highlight');
        		 selectedRowKey = ev.rowKey; // í˜„ì¬ ì„ íƒí•œ í–‰ ì €ì¥
            	
            	
                const rowData = productNumGrid.getRow(ev.rowKey);
                if (!rowData) {
                    console.warn("âŒ ì„ íƒí•œ ë°ì´í„°ê°€ ì—†ìŒ.");
                    return;
                }

                // âœ… sessionStorageì— ì €ì¥
                sessionStorage.setItem("selectedGoodsCode", rowData.goodsCode || '');
                sessionStorage.setItem("selectedGoodsName", rowData.goodsName || '');
                sessionStorage.setItem("selectedOptionCode", rowData.optionCode || '');
                sessionStorage.setItem("selectedOptionName", rowData.optionName || '');
                sessionStorage.setItem("selectedOptionNum", rowData.optionNum || '');
                sessionStorage.setItem("selectedVendorName", rowData.vendorName || '');
                sessionStorage.setItem("selectedVendorId", rowData.vendorId || '');
                sessionStorage.setItem("selectedGoodsStandard", rowData.goodsStandard || '');
                sessionStorage.setItem("selectedGoodsSupplyPrice", rowData.goodsSupplyPrice || '');
              

                console.log("âœ… ì£¼ë¬¸ì„œ ë°ì´í„°ê°€ sessionStorageì— ì €ì¥ë¨.");
            });
        } else {
            console.warn("âŒ orderListGridê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ");
        }
    }, 500);
});


let productNumGrid;

let selectedCompanyNum = [[${session.companyNum}]];

function initProductNumGrid() {
    console.log("âœ… initProductGrid() ì‹¤í–‰");

    
    if (!selectedCompanyNum) {
        console.error("âŒ ì„¸ì…˜ì—ì„œ companyNum ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ.");
        return;
    }
    

    console.log("âœ… ì„¤ì •ëœ companyNum:", selectedCompanyNum);

    const productNumDataSource = {
        api: {  
            readData: { 
                url: '/purchs/rest/goods/nums', 
                method: 'GET',
                requestOptions: {
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin'
                },
                initParams: { 
                    page: 1,
                    perPage: 10,
                    companyNum: selectedCompanyNum
                }
            }
        },
        contentType: 'application/json',
        serverSidePagination: true
    };

    productNumGrid = new tui.Grid({
        el: document.getElementById('productNumGrid'),
        data: productNumDataSource, 
        scrollX :true,
        scrollY : false,
        rowHeight: 40,  // âœ… í–‰ í¬ê¸° ê³ ì • (ê¸°ë³¸ê°’: auto â†’ 40pxë¡œ ì§€ì •)
        pageOptions: {
            useClient: false,
            perPage: 5,
        },
        bodyHeight: 'auto', 
        columns: [
            { header: "ìƒí’ˆëª…", name: "goodsName",  align: "left",rowSpan: true, className: "merged-cell", },
            { header: "ìƒí’ˆì½”ë“œ", name: "goodsCode", align: "left",rowSpan: true, className: "merged-cell",  },
            { header: "ì˜µì…˜ëª…", name: "optionName" , align: "left"},
            { header: "ì˜µì…˜ë²ˆí˜¸", name: "optionCode" , align: "left"},
            { header: "ë¸Œëœë“œ", name: "brandName", align: "left" },
            { header: "ì´ì¬ê³ ", name: "totalQuantity", align: "right",formatter:(row)=>numberFormat(row.value)},
            { header: "ì•ˆì „ì¬ê³ ", name: "optionSafetyInvoice", align: "right",formatter:(row)=>numberFormat(row.value)},
        ]
    });

    console.log("âœ… ìƒí’ˆ ê·¸ë¦¬ë“œ ì´ˆê¸°í™” ì™„ë£Œ");
    
    // âœ… ì´ ì¬ê³ ê°€ ì•ˆì „ì¬ê³  ì´í•˜ì¸ ê²½ìš° ìŠ¤íƒ€ì¼ ì ìš©
    productNumGrid.on("onGridUpdated", function () {
        productNumGrid.getData().forEach((row, rowIndex) => {
            const totalQuantity = parseInt(row.totalQuantity) || 0;
            const safetyStock = parseInt(row.optionSafetyInvoice) || 0;

            if (totalQuantity <= safetyStock) {
                productNumGrid.addRowClassName(rowIndex, 'low-stock-warning');
            } else {
                productNumGrid.removeRowClassName(rowIndex, 'low-stock-warning');
            }
        });
    });
    
 
    
}



// âœ… í‘œì‹œ ìˆ˜ëŸ‰ ë³€ê²½
function changeProductNumDisplay() {
    let gap = parseInt(document.querySelector('#product_num_display_amount').value);
    productNumGrid.setPerPage(gap);
    productNumGrid.reloadData();
}

// âœ… ê²€ìƒ‰ ì‹¤í–‰
function productNumSearch() {
    let goodsName = document.querySelector('#searchGoodsNumName').value;
    let brandName = document.querySelector('#searchBrandNumName').value;

    productNumGrid.setRequestParams({
        "companyNum": [[${session.companyNum}]],
        "goodsName": goodsName,
        "brandName": brandName
    });

    productNumGrid.reloadData();
}

// âœ… í•„í„° ì´ˆê¸°í™”
function resetNumFilters() {
    document.querySelector('#searchGoodsNumName').value = '';
    document.querySelector('#searchBrandNumName').value = '';
    document.querySelector('#product_num_display_amount').value = '10';

    productNumGrid.setRequestParams({
        "companyNum": [[${session.companyNum}]],
        "goodsName": '',
        "brandName": ''
    });

    productNumGrid.reloadData();
}

</script>
</body>



